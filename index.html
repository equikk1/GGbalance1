<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GGbalancee — Вход и Регистрация</title> 
<style>
  body {
    margin: 0; padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #ffeb3b;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: background-color 0.4s ease, color 0.4s ease;
  }
  h1, h2 {
    margin-bottom: 1rem;
    text-align: center;
  }
  button, select, input {
    padding: 10px;
    border-radius: 5px;
    border: none;
    margin-top: 10px;
    width: 100%;
    max-width: 350px;
    font-size: 1rem;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  button {
    background-color: #ffeb3b;
    color: #121212;
    cursor: pointer;
  }
  button:hover {
    background-color: #fbc02d;
  }
  input, select {
    background-color: #222;
    color: #ffeb3b;
  }
  input::placeholder {
    color: #ffd600aa;
  }
  form {
    max-width: 350px;
    width: 100%;
    margin-bottom: 10px;
    display: flex;
    flex-direction: column;
  }
  #user-info {
    margin: 15px 0;
    font-weight: bold;
    text-align: center;
  }
  #purchase-section {
    max-width: 400px;
    width: 100%;
    background: #1e1e1e;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 15px #ffeb3baa;
    display: none;
    flex-direction: column;
    align-items: center;
    animation: fadeIn 0.6s ease forwards;
  }
  #signOutBtn {
    margin-top: 10px;
    background-color: #ff6f00;
    color: white;
  }
  #signOutBtn:hover {
    background-color: #e65100;
  }
  #message, #purchase-message {
    margin-top: 15px;
    font-weight: 600;
    text-align: center;
  }
  #themeToggleBtn {
    margin-top: 15px;
    max-width: 350px;
  }
  .light-theme {
    background: #fefefe;
    color: #121212;
  }
  .light-theme input, .light-theme select {
    background: #ddd;
    color: #121212;
  }
  .light-theme button {
    background-color: #ffeb3b;
    color: #121212;
  }
  .light-theme button:hover {
    background-color: #fbc02d;
  }
  .light-theme #purchase-section {
    background: #fff;
    box-shadow: 0 0 15px #ffeb3baa;
  }
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(10px);}
    to {opacity: 1; transform: translateY(0);}
  }
  .toggle-link {
    margin-top: 10px;
    color: #ffd600;
    text-align: center;
    cursor: pointer;
    user-select: none;
    text-decoration: underline;
  }
  /* Стили для чата */
  #chat-container {
    margin-top: 20px;
    width: 100%;
    max-width: 400px;
    height: 300px;
    background: #222;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 0 10px #ffeb3b88;
  }
  #chat-messages {
    flex-grow: 1;
    padding: 10px;
    overflow-y: auto;
    color: #ffeb3b;
    font-size: 0.9rem;
  }
  .message {
    margin-bottom: 8px;
    padding: 6px 10px;
    border-radius: 8px;
    max-width: 80%;
    word-wrap: break-word;
  }
  .message.user {
    background: #ffeb3b;
    color: #121212;
    align-self: flex-end;
  }
  .message.support {
    background: #444;
    color: #ffeb3b;
    align-self: flex-start;
  }
  #chat-input-form {
    display: flex;
    border-top: 1px solid #444;
  }
  #chat-input {
    flex-grow: 1;
    padding: 10px;
    border: none;
    background: #333;
    color: #ffeb3b;
    font-size: 1rem;
  }
  #chat-input::placeholder {
    color: #ffd600aa;
  }
  #chat-send-btn {
    background: #ffeb3b;
    border: none;
    color: #121212;
    padding: 0 15px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #chat-send-btn:hover {
    background-color: #fbc02d;
  }
</style>
</head>
<body>

<h1>GGbalancee</h1>

<!-- Авторизация -->
<div id="auth-section">

  <button id="googleSignInBtn">Войти через Google</button>

  <!-- Форма входа -->
  <form id="emailSignInForm" autocomplete="off">
    <input type="email" id="emailInput" placeholder="Email" required />
    <input type="password" id="passwordInput" placeholder="Пароль" required />
    <button type="submit">Войти</button>
  </form>
  <div class="toggle-link" id="showSignUp">Нет аккаунта? Зарегистрируйтесь</div>

  <!-- Форма регистрации (скрыта по умолчанию) -->
  <form id="emailSignUpForm" autocomplete="off" style="display:none;">
    <input type="email" id="signUpEmail" placeholder="Email" required />
    <input type="password" id="signUpPassword" placeholder="Пароль" required />
    <button type="submit">Зарегистрироваться</button>
  </form>
  <div class="toggle-link" id="showSignIn" style="display:none;">Уже есть аккаунт? Войти</div>

  <div id="auth-message"></div>
</div>

<!-- Магазин (скрыт до входа) -->
<div id="purchase-section">
  <div id="user-info"></div>
  <button id="signOutBtn">Выйти</button>
  <button id="themeToggleBtn">Светлая тема</button>

  <h2>Выберите игру и пакет</h2>
  <select id="gameSelect">
    <option value="">-- Выберите игру --</option>
    <option value="standoff2">Standoff 2</option>
    <option value="brawlstars">Brawl Stars</option>
    <option value="pubg">PUBG</option>
  </select>

  <select id="packageSelect" disabled>
    <option value="">-- Сначала выберите игру --</option>
  </select>

  <form id="purchaseForm" autocomplete="off">
    <input type="text" id="userIdInput" placeholder="Введите ваш ID в игре" required />
    <button type="submit">Купить</button>
  </form>

  <div id="purchase-message"></div>

  <!-- Чат поддержки -->
  <div id="chat-container">
    <div id="chat-messages"></div>
    <form id="chat-input-form">
      <input type="text" id="chat-input" placeholder="Напишите сообщение..." autocomplete="off" required />
      <button type="submit" id="chat-send-btn">Отправить</button>
    </form>
  </div>

</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import {
    getAuth,
    signInWithPopup,
    GoogleAuthProvider,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBTM27Tfduc1Lmi9tz4a6fIGHrXDoorpbo",
    authDomain: "ggbalance-bcdec.firebaseapp.com",
    projectId: "ggbalance-bcdec",
    storageBucket: "ggbalance-bcdec.firebasestorage.app",
    messagingSenderId: "143831093979",
    appId: "1:143831093979:web:015a42ad17104c0a6cf2fe"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const authSection = document.getElementById('auth-section');
  const purchaseSection = document.getElementById('purchase-section');

  const googleSignInBtn = document.getElementById('googleSignInBtn');
  const emailSignInForm = document.getElementById('emailSignInForm');
  const emailInput = document.getElementById('emailInput');
  const passwordInput = document.getElementById('passwordInput');

  const emailSignUpForm = document.getElementById('emailSignUpForm');
  const signUpEmail = document.getElementById('signUpEmail');
  const signUpPassword = document.getElementById('signUpPassword');

  const showSignUp = document.getElementById('showSignUp');
  const showSignIn = document.getElementById('showSignIn');

  const authMessage = document.getElementById('auth-message');
  const userInfo = document.getElementById('user-info');
  const signOutBtn = document.getElementById('signOutBtn');
  const themeToggleBtn = document.getElementById('themeToggleBtn');

  const gameSelect = document.getElementById('gameSelect');
  const packageSelect = document.getElementById('packageSelect');
  const purchaseForm = document.getElementById('purchaseForm');
  const userIdInput = document.getElementById('userIdInput');
  const purchaseMessage = document.getElementById('purchase-message');

  // Чат
  const chatMessages = document.getElementById('chat-messages');
  const chatInputForm = document.getElementById('chat-input-form');
  const chatInput = document.getElementById('chat-input');

  let theme = 'dark';

  // Пакеты для игр
  const packages = {
    standoff2: [
      { value: 'gold_100', text: '100 Голды — 25 000 сум' },
      { value: 'gold_500', text: '500 Голды — 80 000 сум' },
      { value: 'gold_1000', text: '1000 Голды — 170 000 сум' },
    ],
    brawlstars: [
      { value: 'gems_100', text: '100 Гемов — 30 000 сум' },
      { value: 'gems_500', text: '500 Гемов — 120 000 сум' },
      { value: 'gems_1000', text: '1000 Гемов — 220 000 сум' },
    ],
    pubg: [
      { value: 'uc_100', text: '100 UC — 40 000 сум' },
      { value: 'uc_500', text: '500 UC — 180 000 сум' },
      { value: 'uc_1000', text: '1000 UC — 350 000 сум' },
    ],
  };

  // Показать пакеты при выборе игры
  gameSelect.addEventListener('change', () => {
    const game = gameSelect.value;
    packageSelect.innerHTML = '';
    if (!game) {
      packageSelect.disabled = true;
      packageSelect.innerHTML = '<option value="">-- Сначала выберите игру --</option>';
      return;
    }
    packageSelect.disabled = false;
    packages[game].forEach(p => {
      const option = document.createElement('option');
      option.value = p.value;
      option.textContent = p.text;
      packageSelect.appendChild(option);
    });
  });

  // Вход через Google
  googleSignInBtn.addEventListener('click', async () => {
    try {
      await signInWithPopup(auth, provider);
    } catch (error) {
      authMessage.textContent = 'Ошибка входа через Google: ' + error.message;
    }
  });

  // Вход по email
  emailSignInForm.addEventListener('submit', async e => {
    e.preventDefault();
    try {
      await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
      authMessage.textContent = '';
    } catch (error) {
      authMessage.textContent = 'Ошибка входа: ' + error.message;
    }
  });

  // Регистрация по email
  emailSignUpForm.addEventListener('submit', async e => {
    e.preventDefault();
    try {
      await createUserWithEmailAndPassword(auth, signUpEmail.value, signUpPassword.value);
      authMessage.textContent = 'Регистрация успешна! Войдите в аккаунт.';
      toggleForms(false);
    } catch (error) {
      authMessage.textContent = 'Ошибка регистрации: ' + error.message;
    }
  });

  // Переключение форм регистрации/входа
  showSignUp.addEventListener('click', () => toggleForms(true));
  showSignIn.addEventListener('click', () => toggleForms(false));

  function toggleForms(signUp) {
    if (signUp) {
      emailSignInForm.style.display = 'none';
      showSignUp.style.display = 'none';
      emailSignUpForm.style.display = 'block';
      showSignIn.style.display = 'block';
    } else {
      emailSignInForm.style.display = 'block';
      showSignUp.style.display = 'block';
      emailSignUpForm.style.display = 'none';
      showSignIn.style.display = 'none';
    }
    authMessage.textContent = '';
  }

  // Отслеживание состояния пользователя
  onAuthStateChanged(auth, user => {
    if (user) {
      authSection.style.display = 'none';
      purchaseSection.style.display = 'flex';
      userInfo.textContent = `Вы вошли как: ${user.email}`;
      purchaseMessage.textContent = '';
      chatMessages.innerHTML = '';
      loadChatMessages();
    } else {
      authSection.style.display = 'block';
      purchaseSection.style.display = 'none';
    }
  });

  // Выход
  signOutBtn.addEventListener('click', () => {
    signOut(auth);
  });

  // Переключение темы
  themeToggleBtn.addEventListener('click', () => {
    if (theme === 'dark') {
      document.body.classList.add('light-theme');
      themeToggleBtn.textContent = 'Тёмная тема';
      theme = 'light';
    } else {
      document.body.classList.remove('light-theme');
      themeToggleBtn.textContent = 'Светлая тема';
      theme = 'dark';
    }
  });

  // Покупка
  purchaseForm.addEventListener('submit', e => {
    e.preventDefault();
    const game = gameSelect.value;
    const pack = packageSelect.value;
    const userId = userIdInput.value.trim();

    if (!game || !pack || !userId) {
      purchaseMessage.textContent = 'Пожалуйста, заполните все поля.';
      return;
    }

    purchaseMessage.textContent = `Вы успешно заказали пакет "${packages[game].find(p => p.value === pack).text}" для ID ${userId}. Поддержка свяжется с вами.`;
    purchaseForm.reset();
  });

  // --- Чат поддержки (имитация) ---
  let chatLog = [];

  function addMessage(text, sender) {
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message ' + (sender === 'user' ? 'user' : 'support');
    msgDiv.textContent = text;
    chatMessages.appendChild(msgDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function loadChatMessages() {
    chatMessages.innerHTML = '';
    chatLog.forEach(m => addMessage(m.text, m.sender));
  }

  chatInputForm.addEventListener('submit', e => {
    e.preventDefault();
    const text = chatInput.value.trim();
    if (!text) return;

    chatLog.push({ text, sender: 'user' });
    addMessage(text, 'user');
    chatInput.value = '';

    // Имитируем ответ поддержки через 1.5 секунды
    setTimeout(() => {
      const responses = [
        'Спасибо за ваше сообщение! Мы скоро ответим.',
        'Поддержка получила ваш запрос.',
        'Мы работаем над вашим вопросом.',
        'Пожалуйста, подождите, мы с вами свяжемся.',
      ];
      const response = responses[Math.floor(Math.random() * responses.length)];
      chatLog.push({ text: response, sender: 'support' });
      addMessage(response, 'support');
    }, 1500);
  });
</script>

</body>
</html>
